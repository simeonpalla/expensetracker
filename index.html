<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link rel="icon" type="image/png" href="assets/favicon-32x32.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="auth-container" class="auth-container" style="display: none;" role="main" aria-label="Authentication">
        <div class="auth-form">
            <h2>ğŸ’° Expense Tracker</h2>
            
            <div class="auth-tabs" role="tablist" aria-label="Authentication options">
                <button class="auth-tab active" 
                        role="tab" 
                        aria-selected="true" 
                        aria-controls="login-form"
                        id="login-tab-btn">Login</button>
                <button class="auth-tab" 
                        role="tab" 
                        aria-selected="false" 
                        aria-controls="signup-form"
                        id="signup-tab-btn">Sign Up</button>
            </div>

            <div id="auth-error" class="auth-error" style="display: none;" role="alert" aria-live="polite"></div>
            <div id="auth-success" class="auth-success" style="display: none;" role="status" aria-live="polite"></div>

            <form id="login-form" style="display: block;" role="tabpanel" aria-labelledby="login-tab">
                <div class="form-group">
                    <label for="login-email">Email Address</label>
                    <input type="email" 
                           id="login-email" 
                           required 
                           autocomplete="email"
                           aria-describedby="login-email-help">
                    <small id="login-email-help" class="form-help">Enter your registered email address</small>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" 
                           id="login-password" 
                           required 
                           autocomplete="current-password"
                           aria-describedby="login-password-help">
                    <small id="login-password-help" class="form-help">Enter your account password</small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span aria-hidden="true">ğŸ”“</span> Login
                </button>
            </form>

            <form id="signup-form" style="display: none;" role="tabpanel" aria-labelledby="signup-tab">
                <div class="form-group">
                    <label for="signup-email">Email Address</label>
                    <input type="email" 
                           id="signup-email" 
                           required 
                           autocomplete="email"
                           aria-describedby="signup-email-help">
                    <small id="signup-email-help" class="form-help">We'll send a verification email to this address</small>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" 
                           id="signup-password" 
                           required 
                           minlength="6" 
                           autocomplete="new-password"
                           aria-describedby="signup-password-help">
                    <small id="signup-password-help" class="form-help">Minimum 6 characters required</small>
                </div>
                <div class="form-group">
                    <label for="signup-confirm">Confirm Password</label>
                    <input type="password" 
                           id="signup-confirm" 
                           required 
                           minlength="6" 
                           autocomplete="new-password"
                           aria-describedby="signup-confirm-help">
                    <small id="signup-confirm-help" class="form-help">Re-enter your password</small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span aria-hidden="true">ğŸ“</span> Create Account
                </button>
            </form>

            <p style="margin-top: 20px; font-size: 14px; color: #6b7280;">
                <a href="#" id="forgot-password-link" style="color: var(--primary-color);">
                    Forgot Password?
                </a>
            </p>

            <form id="reset-form" style="display: none;">
                <div class="form-group">
                    <label for="reset-email">Email Address</label>
                    <input type="email" 
                           id="reset-email" 
                           required 
                           autocomplete="email"
                           aria-describedby="reset-email-help">
                    <small id="reset-email-help" class="form-help">Enter your email to receive reset instructions</small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span aria-hidden="true">ğŸ“§</span> Send Reset Link
                </button>
                <button type="button" 
                        id="back-to-login-btn"
                        class="btn btn-secondary" 
                        style="width: 100%; margin-top: 10px;">
                    <span aria-hidden="true">â†</span> Back to Login
                </button>
            </form>
        </div>
    </div>

    <div class="container" style="display: none;" role="main" aria-label="Expense Tracker Application">
        <header class="header">
            <h1>ğŸ’° Expense Tracker</h1>
            <p>Track your income and expenses</p>
            <div id="connection-status" class="status-indicator" role="status" aria-live="polite">
                <span id="status-dot" class="status-dot connecting" aria-hidden="true"></span>
                <span id="status-text">Connecting to database...</span>
            </div>
        </header>

        <nav class="nav-tabs" role="navigation" aria-label="Main navigation">
            <button class="nav-tab active" 
                    id="add-transaction-tab"
                    data-page="add-transaction"
                    aria-pressed="true">
                <span aria-hidden="true">â•</span> Add Transaction
            </button>
            <button class="nav-tab" 
                    id="dashboard-tab"
                    data-page="dashboard"
                    aria-pressed="false">
                <span aria-hidden="true">ğŸ“Š</span> Dashboard
            </button>
            <button class="nav-tab" 
                    id="categories-tab"
                    data-page="categories"
                    aria-pressed="false">
                <span aria-hidden="true">ğŸ“</span> Categories
            </button>
            <button class="nav-tab" 
                    id="ai-tab"
                    data-page="ai-insights"
                    aria-pressed="false"
                    style="background: linear-gradient(135deg, #a855f7 0%, #d946ef 100%);">
                <span aria-hidden="true">âœ¨</span> AI Coach
            </button>
        </nav>

        <div id="add-transaction" class="page active" role="tabpanel" aria-labelledby="add-transaction-tab">
            <h2>Add New Transaction</h2>
            <form id="transaction-form" class="transaction-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="type">Transaction Type</label>
                        <select id="type" required aria-describedby="type-help">
                            <option value="">Select Type</option>
                            <option value="income">ğŸ’° Income</option>
                            <option value="expense">ğŸ’¸ Expense</option>
                        </select>
                        <small id="type-help" class="form-help">Choose whether this is money coming in or going out</small>
                    </div>

                    <div class="form-group">
                        <label for="amount">Amount (â‚¹)</label>
                        <div class="amount-input">
                            <span class="rupee-symbol" aria-hidden="true">â‚¹</span>
                            <input type="number" 
                                   id="amount" 
                                   step="0.01" 
                                   min="0.01" 
                                   placeholder="0.00" 
                                   required
                                   aria-describedby="amount-help">
                        </div>
                        <small id="amount-help" class="form-help">Enter the transaction amount in rupees</small>
                    </div>

                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" required aria-describedby="category-help">
                            <option value="">Select Category</option>
                        </select>
                        <small id="category-help" class="form-help">Choose a category that best describes this transaction</small>
                    </div>

                    <div class="form-group">
                        <label for="payment-to">Payment To</label>
                        <input type="text" 
                               id="payment-to" 
                               placeholder="e.g., Zomato, Local Store" 
                               required
                               aria-describedby="payment-to-help">
                        <small id="payment-to-help" class="form-help">Who or where did you pay?</small>
                    </div>

                    <div class="form-group">
                        <label for="payment-source">Payment Source</label>
                        <select id="payment-source" required aria-describedby="payment-source-help">
                            <option value="">Select Source</option>
                            <option value="upi">UPI</option>
                            <option value="credit-card">Credit Card</option>
                            <option value="debit-card">Debit Card</option>
                            <option value="cash">Cash</option>
                        </select>
                        <small id="payment-source-help" class="form-help">How did you make this payment?</small>
                    </div>

                    <div class="form-group">
                        <label for="source-details">Bank / Card</label>
                        <select id="source-details" aria-describedby="source-details-help">
                            <option value="">Select Details</option>
                        </select>
                        <small id="source-details-help" class="form-help">Select the specific bank or card used</small>
                    </div>

                    <div class="form-group">
                        <label for="date">Transaction Date</label>
                        <input type="date" 
                               id="date" 
                               required
                               aria-describedby="date-help">
                        <small id="date-help" class="form-help">When did this transaction occur?</small>
                    </div>

                    <div class="form-group full-width">
                        <label for="description">Description (Optional)</label>
                        <textarea id="description" 
                                  placeholder="Enter transaction details..."
                                  aria-describedby="description-help"></textarea>
                        <small id="description-help" class="form-help">Add any additional notes about this transaction</small>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span aria-hidden="true">ğŸ’¾</span> Save Transaction
                    </button>
                    <button type="button" class="btn btn-secondary" id="clear-form-btn">
                        <span aria-hidden="true">ğŸ”„</span> Clear Form
                    </button>
                </div>
            </form>
        </div>

        <div id="dashboard" class="page" role="tabpanel" aria-labelledby="dashboard-tab">
            <div class="dashboard-header">
                <h2 id="dashboard-title">My Finances</h2>
                <div style="font-size: 0.9rem; color: #6b7280; margin-top: 5px;">
                    <span id="cycle-label">Loading cycle...</span>
                </div>
            </div>
            
            <div class="stats-grid" role="region" aria-label="Financial summary for selected month">
                <div class="stat-card income-card">
                    <div class="stat-icon" aria-hidden="true">ğŸ’°</div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-income" aria-label="Total income amount">â‚¹0.00</div>
                        <div class="stat-label">Total Income</div>
                    </div>
                </div>
                <div class="stat-card expense-card">
                    <div class="stat-icon" aria-hidden="true">ğŸ’¸</div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-expenses" aria-label="Total expenses amount">â‚¹0.00</div>
                        <div class="stat-label">Total Expenses</div>
                    </div>
                </div>
                <div class="stat-card balance-card" id="balance-card">
                    <div class="stat-icon" aria-hidden="true">ğŸ’µ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="net-balance" aria-label="Net balance amount">â‚¹0.00</div>
                        <div class="stat-label">Remaining Budget</div>
                    </div>
                </div>
                <div class="stat-card streak-card" id="streak-card">
                    <div class="stat-icon">ğŸ”¥</div>
                    <div class="stat-content">
                        <div class="stat-value" id="current-streak">0 Days</div>
                        <div class="stat-label">No-Spend Streak</div>
                        <small id="best-streak" style="font-size: 12px; color:#6b7280;">Best: 0 days</small>
                    </div>
                </div>
            </div>

            <div class="chart-container" role="region" aria-label="Income vs expenses chart">
                <h3 id="line-chart-title"><span aria-hidden="true">ğŸ“ˆ</span> Daily Breakdown</h3>
                <canvas id="chart" aria-label="Line chart showing income and expenses for the selected month"></canvas>
            </div>

            <div class="chart-container" id="donut-chart-container" role="region" aria-label="Expense breakdown chart">
                <h3 id="donut-chart-title"><span aria-hidden="true">ğŸ“Š</span> Expenses by Source</h3>
                <canvas id="expense-donut-chart" aria-label="Donut chart showing expense breakdown"></canvas>
                <button id="reset-chart-view-btn" 
                        class="btn btn-secondary" 
                        style="display: none; margin-top: 15px;"
                        aria-label="Return to expense sources view">
                    <span aria-hidden="true">â¬…ï¸</span> Back to Sources
                </button>
            </div>

            <div class="transactions-section" role="region" aria-label="Transaction history">
                <div class="section-header">
                    <h3><span aria-hidden="true">ğŸ“‹</span> Transactions for Selected Month</h3>
                    <div class="filter-controls" role="group" aria-label="Transaction filters">
                        <label for="filter-type" class="sr-only">Filter by transaction type</label>
                        <select id="filter-type" aria-label="Filter transactions by type">
                            <option value="">All Types</option>
                            <option value="income">Income Only</option>
                            <option value="expense">Expenses Only</option>
                        </select>
                        <label for="filter-category" class="sr-only">Filter by category</label>
                        <select id="filter-category" aria-label="Filter transactions by category">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                </div>
                <div id="transactions-list" 
                     class="transactions-list" 
                     role="region" 
                     aria-label="Transaction list"
                     aria-live="polite">
                    <div class="loading">Loading transactions...</div>
                </div>
                <div id="load-more-container" class="load-more-container" style="display: none;">
                    <button id="load-more-btn" 
                            class="btn btn-secondary"
                            aria-label="Load more transactions">
                        Load More
                    </button>
                </div>
            </div>
        </div>

        <div id="categories" class="page" role="tabpanel" aria-labelledby="categories-tab">
            <h2><span aria-hidden="true">ğŸ“</span> Manage Categories</h2>
            
            <div class="categories-section">
                <div class="add-category-form" role="region" aria-label="Add new category">
                    <h3>Add New Category</h3>
                    <form id="category-form">
                        <div class="form-row">
                            <label for="category-name" class="sr-only">Category name</label>
                            <input type="text" 
                                   id="category-name" 
                                   placeholder="Category name" 
                                   required
                                   aria-label="Category name">
                            
                            <label for="category-type" class="sr-only">Category type</label>
                            <select id="category-type" required aria-label="Category type">
                                <option value="">Type</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                            
                            <label for="category-icon" class="sr-only">Category icon</label>
                            <input type="text" 
                                   id="category-icon" 
                                   placeholder="Icon (emoji)" 
                                   maxlength="2"
                                   aria-label="Category icon emoji">
                            
                            <button type="submit" class="btn btn-primary" aria-label="Add new category">
                                Add
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="categories-display" role="region" aria-label="Category list">
                    <div class="category-group">
                        <h4><span aria-hidden="true">ğŸ’°</span> Income Categories</h4>
                        <div id="income-categories" 
                             class="category-grid" 
                             role="group" 
                             aria-label="Income categories"></div>
                    </div>
                    <div class="category-group">
                        <h4><span aria-hidden="true">ğŸ’¸</span> Expense Categories</h4>
                        <div id="expense-categories" 
                             class="category-grid" 
                             role="group" 
                             aria-label="Expense categories"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="ai-insights" class="page" role="tabpanel" aria-labelledby="ai-tab">
            <div class="dashboard-header">
                <h2>ğŸ’° Financial AI Coach</h2>
            </div>

            <div class="ai-container" style="text-align: center; max-width: 600px; margin: 0 auto;">
                <div class="ai-card" style="background: linear-gradient(135deg, #f3e8ff 0%, #fae8ff 100%); padding: 30px; border-radius: 20px; border: 2px solid #d8b4fe; margin-bottom: 20px;">
                    <div style="font-size: 40px; margin-bottom: 15px;">ğŸ¤–</div>
                    <h3>Analyze My Spending</h3>
                    <p style="color: #6b7280; margin-bottom: 20px;">
                        I will look at your spending since your last salary and give you tips to save money.
                    </p>
                    
                    <div id="ai-controls">
                        <input type="password" id="ai-api-key" placeholder="Enter Gemini API Key" 
                            style="padding: 12px; border-radius: 8px; border: 1px solid #ccc; width: 70%; margin-bottom: 15px;">
                        <br>
                        <button id="generate-ai-btn" class="btn btn-primary" style="background: #9333ea; border:none;">
                            âœ¨ Analyze Now
                        </button>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #9333ea;">Get a Free Gemini Key Here</a>
                        </p>
                    </div>
                    
                    <div id="ai-loading" style="display: none; margin-top: 20px;">
                        <span class="status-dot connecting" style="background: #9333ea;"></span> Thinking...
                    </div>
                </div>

                <div id="ai-result" class="ai-result" style="display: none; text-align: left; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); line-height: 1.6;">
                </div>
            </div>
        </div>

        <footer role="contentinfo">
            <button id="logout-btn" 
                    class="logout-btn" 
                    aria-label="Log out of application">
                <span aria-hidden="true">ğŸšª</span> Logout
            </button>
        </footer>
    </div>

    <div id="notification" 
         class="notification" 
         role="alert" 
         aria-live="assertive"
         aria-atomic="true">
        <span id="notification-message"></span>
        <button id="notification-close" 
                class="notification-close"
                aria-label="Close notification">
            &times;
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="supabase-config.js"></script>
    <script src="script.js?v=2"></script>

</body>
</html>